作者：whitefox
email: whitefox.jiang@corp.elong.com
日期：2000-07-20 09:44:02
SSLc滴徽JC


--------------------------------------------------------------------------------


[ 本文重c | SSL安全Y料鬏 | SSL\作步EcO定 | 金(key)a生c管理 ]

[ Microsoft Certificate Server | 用舳苏JC(Client Certificate) ]

　


--------------------------------------------------------------------------------

　

本文重c

介B衢T的SSLc滴徽JC方法，包括SSL安全B的伺服器JC、SSL\作步EcO定、金（key）a生c管理，以及IIS 4.0的Microsoft Certificate Server之伺服器JC、用舳苏JC等方法。

Windows NT Option Pack中文版w所包含的「Microsoft Certificate Server」，可自行建立一JC中心（Certificate Authority），以管理滴徽JC的授c、U除及更新，滴徽JC用於公_金加解密之用，譬如SSL的伺服器JCc用舳苏JC，您透^Intranet或 Internet 安全地魉唾Y料。

SSL安全Y料鬏

SSL（Secure Sockets Layer）

SSL（Secure Sockets Layer）加密方法，可以Y料鬏做安全上的保o。

使用者魉退接匈Y料（譬如信用卡或y行ぬ）到W站r，可能害怕Y料魉彤中被r截。SSL（Secure Sockets Layer）3.0f定，提供了鬏安全上的保o，於使用者魉唾Y料前先做「加密」成ya，W站接收Y料後再「解密」出原淼馁Y料。Y料魉彤中即使被r截，也只是看到一堆ya，看不到原淼馁Y料。

使用SSL安全方法r，使用者a生一把ΨQ金（session key ），⒋魉偷馁Y料「加密」成ya，W站接收Y料後再使用同一把ΨQ金「解密」出原淼馁Y料。

榱⑹褂谜弋a生的@一把加解密用的ΨQ金安全地鹘o伺服器，SSL於使用者魉瓦@一把ΨQ金前，先使用伺服器的公_金（public key）ΨQ金「加密」成ya，W站接收Y料後再使用伺服器的私密金（private key）「解密」出原淼ΨQ金。

本文εcSSL相P的伺服器JC（Server Certificates）、SSL\作的步EcO定、金（key）a生c管理，介B如下：

伺服器JC（Server Certificates）

使用SSL安全方法r，榱舜_保使用者拿到的伺服器公_金（public key）檎_的，伺服器必由具公信力的JC中心（Certificate Authority，QCA），核l伺服器JC（Server Certificates）。

一JC就像一印aC明，C明@印章凫赌所有，不是e人假造的。

伺服器JC包括提供W站热菡叩慕M、和JC中心的名Q，以及伺服器的公_金。

JC中心CA

使用SSL安全方法Br，必先取得伺服器JC。

伺服器JC是否成功，取Q於使用者是否信任JC中心核l的伺服器JCY料是否檎_有效。

譬如一使用者c您的W站伺服器建立Br，即使看到您伺服器的JC，可能仍然q豫是否要⑿庞每ㄙY料提供o您，尤其是您的公司是新的或]有甚N知名度r，更加地q豫不Q。

基於@理由，有rJCS由具有公信力的第三者JC中心（Certificate Authority，QCA）所核l。JC中心有任_JJC的Y料是否檎_有效。

有S多的第三者JC中心，提供IIS核l伺服器JC（server certificate）的服眨如下：

Verisign Inc.：http://www.verisign.com 
GTE CyberTrust Solutions：http://www.cybertrust.gte.com 
Thawte Consulting：http://www.thawte.com 
CertiSign Certificado Digital Ltda.：http://www.certisign.com.br 
BelSign NV-SA：http://www.belsign.be 
Keywitness Canada：http://www.keywitness.ca 
BankGate CA：http://www.bankgate.com 
可B到http://www.microsoft.com/security/ 取得最新提供IIS伺服器JC（server certificate）服盏恼JC中心CA名巍

另外一替代方式，取Q於您公司cW站伺服器使用者的PS如何，您能蜃约撼洚JC中心，核l伺服器JC（Server Certificates）o自己。譬如，於大公司的企I染W路中，理T工的薪Y和福利r，公司管理局可以Q定是否自己So一JC伺服器（certificate server）以核l伺服器JCo自己的伺服器。

使用Windows NT Option Pack中的Microsoft Certificate Server，可以建立一JC伺服器，自己充JC中心，核l伺服器JC。

SSL\作步EcO定

SSL\作的步E

SSL\作的步E如下：

使用者的g[器使用「https」通方式cW站伺服器建立B。 
W站伺服器魉桶括伺服器公_金的伺服器JC（Server Certificates）o使用者。 
使用者的g[器a生一把加解密用的ΨQ金（session key），使用伺服器的公_金（public key）ΨQ金「加密」成ya，魉徒oW站伺服器。 
W站伺服器使用伺服器的私密金（private key），以「解密」出g[器a生的ΨQ金。 
W站伺服器cg[器使用@一把ΨQ金，①Y料做加解密以相互魉唾Y料。 
伺服器加入SSL功能

於伺服器加入SSL（Secure Sockets Layer）的功能，可以_保Y料鬏的安全性。要如何於伺服器加入SSL功能呢？有以下步E：

a生一Key（金）：第一步E，首先使用 [Rea管理T]（Key Manager）於NT上建立一π碌Key（金），a生一JC申n案（certificate request file），AONewKeyRq.txtn。您再⒋苏JC申n案鹘oJC中心（Certificate Authority，QCA），或使用 [Rea管理T]（Key Manager）魉汀CA可由具有公信力的第三者扮演，Microsoft Certificate Server也可扮演此CA的角色。CA核梳⒑税l伺服器JC（server certificate），魉徒o您一JCn案（certificate file）。 
安b伺服器JCn案：您收到CA核l的伺服器JCn案r，使用 [Rea管理T]（Key Manager）安b@n案。 
於IISO定安全鬏port 443和SSL：绦 IIS 4.0的 [Internet 服展芾T] ，x褚使用SSL的W站，如AO的Web站台，按下滑鼠右I，x [热]，x [目安全] ，按下 [安全通] 的 [] 按o，x [存取@Y源r，必使用安全通道] 。若如此O定，t整O定的站台，如上AO的Web站台，都必使用「https:// 」的SSL方式。 
O定使用SSL的方法

@方法O定「整」的W站、目、或n案使用SSL的方法魉偷馁Y料做加解密。

於 [Internet 服展芾T] ，x褚W站（Web site）、目、或n案，按下滑鼠右I_ [热] 。 
x [目安全] 或 [n案安全] ，於 [安全通] 下按下 [] 按o（若未a生一key，先按下 [Rea管理T]（Key Manager）a生之）。 
於 [安全通] υ盒中 ，x [存取@Y源r，必使用安全通道]。 
使用者的g[器使用「https://」通方式cW站伺服器建立B。 
O定加解密金的L度

加解密Y料所用的ΨQ金（session key）L度愈L，愈不容易被破解。

您能蛟O定W站伺服器需要使用128位元L度的ΨQ金（session key），而非AO的40位元的L度。若您O定橹辽128位元L度，t想要c伺服器建立安全B的使用者，必裼媚虍a生128位元ΨQ金的g[器。

基於美法律的限制，128位元金L度HH可以使用於美和加拿大。

您必先恼JC中心取得伺服器JC（Server Certificates），才可以建立安全的SSLB。

O定加解密金L度的方法，如下：

於 [Internet 服展芾T] ，x褚W站（Web site）、目、或n案，按下滑鼠右I_ [热] 。 
x [目安全] 或 [n案安全] ，於 [安全通] 下按下 [] 按o（若未a生一key，先按下 [Rea管理T]（Key Manager）a生之）。 
於 [安全通] υ盒中 ，x [存取@Y源r，必使用安全通道] 後，按下 [加密O定] 按o。 
於 [加密O定] υ盒中 ，x [需要128位元加密] 後按下 [_J] 按o。 
金（key）a生c管理

Rea管理T（Key Manager）

SSL所使用的一金（key），包括公_金（public key）和私密金（private key），可以使用NT的「Rea管理T」（Key Manager）懋a生、R入（import）、和R出（export）@一ξㄒ坏慕痂（key），以供申伺服器JC（Server Certificates）之用。

您也可以使用「Rea管理T」（Key Manager），砩暾和安b伺服器JC（Server Certificates），以及檫h端的伺服器a生一金（key）。

一domain name只能安b一伺服器JC（Server Certificates）。

一金（key）只能使用於一伺服器JC（Server Certificates）。

一金（key）只能使用於一domain name，但是多IP address可因共用同一domain name而共用同一金（key）。

绦小缸Rea管理T」（Key Manager）有方法，您 於 [Internet 服展芾T] x褚W站（Web site）、目、或n案r，方法如下：

按下工具列的 [Rea管理T]（Key Manager）D示。 
按下滑鼠右I_ [热] ，x瘛 [目安全] 」或 [n案安全] ，於 [安全通] 下按下 [] 按o，再按下 [Rea管理T]（Key Manager）按o。 
a生金（key）方法

a生一金（key）的方法如下：

於 [Internet 服展芾T] 按下工具列的 [Rea管理T]（Key Manager）D示。 
於 [Rea] x芜x [建立Rea]，依照指示即可a生一金（key）。 
可以x⑺a生的一金（key）Υ娉梢n案以魉徒oJC中心，或向Microsoft Certificate Server上自由暾伺服器JC。

a生一金（key）r，可向JC中心提出伺服器JC（Server Certificates）的申。若您接收到JC中心提供的一cMicrosoft Certificate Server相容的application plug-in，即可上自由暾伺服器JC。

您 [Rea管理T]（Key Manager）所a生的一金（key），做您家Y的金一般地好好保存起恚不要掉了或e人拿到。

建h您⒔痂（key）做一份浞莸酱诺片，K⒋舜诺片放置於安全的地方。您更新或重新安bIISr可能h除而共用同一金（key）和伺服器JC（Server Certificates），此r就需要使用@金（key）浞荽诺片了。

浞萁痂方法如下：

於 [Rea管理T]（Key Manager）x翊浞莸慕痂。 
於 [Rea] x芜x [R出Rea] 和 [浞n] 等，依照指示即可浞萁痂（key）到一磁碟片的n案。 
安b伺服器JC

a生金（key）向JC中心申伺服器JC（Server Certificates）後，@得核l的JC。您可以⑺核l的JC，}uΥ娴揭n案，再使用 [Rea管理T]（Key Manager）安bJC到W站伺服器。

安b伺服器JC，方法如下：

⒄JC中心核l的JC，Υ娉梢文字n案，附n名.txt。 
於 [Internet 服展芾T] 按下工具列的 [Rea管理T]（Key Manager）D示，x翊安bJC的金（key）。 
於keyx芜xInstall Key Certificate，於「Open 」υ盒中x裾JC的.txtn案，按下Open ，入JCn案密a後，按下OK按o即可以安b好伺服器JC。 
新增或金（key）的指定IP

同一domain name的多IP address可共用同一金（key）。您也可以指定一金（key）只能使用於一IP address。

使用的是新增或金（key）的指定IP address方法，如下：

於 [Internet 服展芾T] 按下工具列的 [Rea管理T]（Key Manager）D示，x翊O定的金（key）。 
於 [Rea] x芜x [热] ，於 [伺服器B接] υ盒中x [新增] 或 []。 
於 [B接] υ盒入IP address（可由...按ox裰）。 
若未指定一IP Address，t同一domain name中的多IP address⒍际褂么私痂（key）。

金O定IP address的原t如下：

一IP address不能O定多伺服器JC（Server Certificates）。 
一IP address不能O定多W站。但是一W站能O定多IP address。 
一W站不能O定多SSL ports。 
Microsoft Certificate Server

Windows NT Option Pack中Microsoft Certificate Server，您的W站成橐JC中心（Certificate Authority，QCA），可以：

核定伺服器JC（server certificate）：o需求建立SSL安全B的W站。 
核定用舳苏JC（Client Certificate）：o每位使用者以伺服器自域C使用者的身份。 
伺服器JC

榱耸褂SSL_保Y料鬏的安全性，伺服器首先必恼JC中心（Certificate Authority，QCA）@得一伺服器JC（server certificate）。

Microsoft Certificate Server，可扮演核l伺服器JC（server certificate）的JC中心（Certificate Authority，QCA）。

要如何使用Windows NT Option Pack中的Microsoft Certificate Server核l伺服器JC，於伺服器加入SSL功能呢？步E如下：

第一步E：a生一Key和提出伺服器JC申。 
第二步E：於g[器安bJC中心JC（Certificate Authority Certificate），Microsoft Certificate Server的JC中心於g[器登椤缚尚湃巍沟恼JC中心，接受此JC中心所核l之所有JC。 
第三步E：重新IIS。 
a生一Key和提出伺服器JC申

第一步E，首先於NT上建立一新的金（Key），方法绦Windows NT Option Pack中的 [Internet 服展芾T] ，於 [Rea管理T]（Key Manager）按下滑鼠左I。

滑鼠按下「WWW」，於 [Rea] x芜x [建立Rea]，x瘛缸⒛的要求魉偷骄上授挝弧椤Microsoft Certificate Server」，即上向Microsoft Certificate Server提出伺服器JC申。

入金（key）名Q、密a、和L度。

入申公司名Q（Organization）、部T（Organizational Unit）、伺服器URLW址（Common Name）。

入e（Country）、省份（State/Province）、城市（City/Locality） ，最後按下「完成」按o，即可以a生一新的金（Key），K⒋艘πKey鹘oJC中心Microsoft Certificate Server。 

即可a生即可a生一金（key）。

出F [伺服器B接的面] ，按下 [新增] 按o，x瘛肝粗付IP Address」和「未指定PORT」，最後按下 [_J] 按o。

_J所a生的新金（Key）位於「WWW」下。

x [X] x蔚 [立即_J更] ，K_J所做的更。

a生新的金（Key）和提出伺服器JC申後，Microsoft Certificate Server取得伺服器JC（server certificate）K自影惭b之。

於g[器登「可信任」的JC中心

伺服器取得K安b伺服器JC後，第二步E於g[器安bJC中心JC（Certificate Authority Certificate），Microsoft Certificate Server的JC中心於g[器登椤缚尚湃巍沟恼JC中心，接受此JC中心所核l之所有JC。

安bJC中心JC方法，槭褂谜呤褂IEg[器，入Microsoft Certificate Server的Whttp://localhost/CertSrv，其中localhostMicrosoft Certificate Server安b的URL位址。xCertificate Enrollment Tools的Install Certificate Authority Certificates以安bJC中心JC。

於g[器安bJC中心JC，⒄JC中心於g[器登椤缚尚湃巍沟恼JC中心後，可於IEg[器「z」x蔚摹Interrnetx」的「热荨鬼中的「C」按o中，查到已安b的可信任JC中心Y料。

重新IIS

第三步E，重新IIS，於DOS下的WINNT\system32\inetsrv下绦忻令「iisca」，K绦忻令「net stop iisadmin /y」以停止World Wide Web Publishing Service，再绦忻令「net start w3svc」以_World Wide Web Publishing Service（或重新_C），如下：

C:\WINNT\system32\inetsrv> iisca

List of valid Certifiying Authorities ( CA ) successfuly transferred to IIS

C:\WINNT\system32\inetsrv> net stop iisadmin /y

下面的服贞PS到 IIS Admin Service 服铡

停止 IIS Admin Service 服找停止@些服铡

World Wide Web Publishing Service

World Wide Web Publishing Service 服照在停止..

World Wide Web Publishing Service 服找呀成功停止。

.....

IIS Admin Service 服找呀成功停止。

C:\WINNT\system32\inetsrv> net start w3svc

World Wide Web Publishing Service 服照在 ............

World Wide Web Publishing Service 服找呀映晒Α

如此即可使用SSL了。

z查已安b的JC中心Y料

若要z查已安b的JC中心Y料，可使用IEg[器聿榭础

IEg[器使用SSL的「https://」，安bJC中心所核l之JC後，可於IEg[器「z」x蔚摹Internetx」的「热荨鬼中的「C」按o中，查到已安b的JC中心Y料。

用舳苏JC（Client Certificate）

用舳苏JC（Client Certificate），W站伺服器自颖孀R使用者的身份，以使用者入一受限制管制的W站，不需要入「密a」即可自雍入。

用舳苏JC（Client Certificate）包括使用者人Y料、和核l的JC中心、有效期g、序、以及建立安全B的金n案等Y加密而成。

申和安b用舳苏JC（Client Certificate）

每使用者，可以使用Microsoft Certificate Server，砩暾和安b用舳苏JC（Client Certificate）。

申和安b用舳苏JC的方法如下：

首先使用g[器g[Microsoft Certificate Server的用舳苏JC申W： 
http://localhost/CertSrv/CertEnroll/ceenroll.asp

其中localhostMicrosoft Certificate Server安b的URL位址。

或g[Microsoft Certificate Server的Whttp://localhost/CertSrv，xCertificate Enrollment Tools的Request a Client Authentication Certificate。

入申用舳苏JCr所的人Y料。 
填好後，按下Submit Request按o以提出用舳苏JC（Client Certificate）的申，@示下dMicrosoft Certificate Server所核l的用舳苏JC。 
按下Download按o⑾螺dMicrosoft Certificate Server所核l的用舳苏JC，K自影惭b完成。 
安bJC中心所核l之用舳苏JC後，可於IEg[器「z」x蔚摹Interrnetx」的「热荨鬼中的「人」按o中，查到已安b的用舳苏JCY料。按下「人」按o，@示已安b的用舳苏JCY料，可看到申用舳苏JCr所填的人Y料。
